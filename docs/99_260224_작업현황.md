# whynali 작업 현황 (코드 검증 기준)

기준일: 2026-02-24  
검증 방식: 실제 소스 파일 직접 열람 확인

---

## 1. 완료 항목

### 1-1. 인프라·공통

| 항목 | 확인 결과 | 파일 |
|------|-----------|------|
| 관리자 경로 보호 (`/admin/*`, `/api/admin/*`) | 완료 | `middleware.ts` — 비인증 → `/login`, 비관리자 → `/` 리다이렉트 |
| GNB 관리자 버튼 isAdmin 분기 | 완료 | `Header.tsx` — `checkAdmin()` + `isAdmin && <Link>` 조건부 렌더 |
| `requireAdmin()` 공통 유틸 | 완료 | `lib/admin.ts` — 전체 `/api/admin/` 19개 라우트 모두 적용 확인 |
| dev API 운영 환경 차단 | 완료 | `app/api/dev/` 3개 파일 — `NODE_ENV === 'production'` 시 차단 |

### 1-2. 담당 A — 이슈·수집·화력

| 항목 | 확인 결과 | 파일 |
|------|-----------|------|
| 이슈 목록/상세/생성/수정 API | 완료 | `app/api/issues/` |
| 타임라인 포인트 CRUD API | 완료 | `app/api/issues/[id]/timeline/` |
| 뉴스 수집 Cron | 완료 | `app/api/cron/collect-news/route.ts` |
| 커뮤니티 수집 Cron | 완료 | `app/api/cron/collect-community/route.ts` |
| 수집 중복 방지 | 완료 | `naver-news.ts` — `upsert + onConflict('link') + ignoreDuplicates` |
| 이슈 자동 연결 Cron | 완료 | `app/api/cron/auto-link/route.ts` |
| 화력 재계산 Cron | 완료 | `app/api/cron/recalculate-heat/route.ts` |
| API 사용량 집계 | 완료 | `lib/api-usage-tracker.ts` — `call_count`, `success_count`, `fail_count` 분리 |
| 이슈 목록 검색(debounce 350ms) + 상태 필터 + 정렬 | 완료 | `IssueList.tsx` — `DEBOUNCE_MS=350`, `loadingMore` + `offsetRef` 경합 제어 |
| 관리자 이슈 CRUD/승인/반려/숨김/복구 | 완료 | `app/api/admin/issues/` 하위 5개 route |
| 관리자 수집 현황 | 완료 | `app/api/admin/collections/` |
| 홈 + 카테고리별 이슈 목록 페이지 | 완료 | `app/page.tsx`, `entertain·sports·politics·society·tech/page.tsx` |
| 이슈 상세 (화력·타임라인·출처) | 완료 | `app/issue/[id]/page.tsx` |

### 1-3. 담당 B — 참여·커뮤니티·세이프티·인증

| 항목 | 확인 결과 | 파일 |
|------|-----------|------|
| 소셜 로그인 (구글·네이버·카카오) | 완료 | `app/auth/` 하위 route + Supabase Auth |
| 댓글 CRUD + 좋아요/싫어요 | 완료 | `app/api/comments/` |
| 댓글 베스트 상단 (`best=true`) | 완료 | `comments/route.ts` — `?best=true` 파라미터, score 상위 3개 |
| 댓글 정렬 3종 (최신/좋아요/싫어요순) | 완료 | `CommentsSection.tsx` + `comments/route.ts` |
| 댓글 검토 상태값 | 완료 | `pending_review` 로 통일 — POST 저장·GET 조회 일치 |
| 리액션(감정 7종) | 완료 | `app/api/reactions/route.ts` |
| 투표 참여/취소 트랜잭션 | 완료 | `votes/[id]/vote/route.ts` — `vote_participate`, `vote_cancel` RPC 원자 처리 |
| 토론 주제 CRUD | 완료 | `app/api/discussions/` |
| 토론 댓글 CRUD | 완료 | `app/api/discussions/[id]/comments/` |
| 세이프티봇 금칙어 검증 | 완료 | `lib/safety.ts` — `loadBannedWords()` 공통 함수 정의 |
| 커뮤니티 목록 검색 + `issue_id` 필터 + 더보기 | 완료 | `app/community/page.tsx` |
| "이 이슈의 커뮤니티" 링크 | 완료 | `community/page.tsx` — `?issue_id=` 파라미터로 필터 + 이슈 제목 표시 |
| 글로벌 검색 | 완료 | `app/api/search/route.ts`, `app/search/page.tsx` |
| 로그인 페이지 | 완료 | `app/login/page.tsx` |
| 관리자 토론/세이프티/로그 페이지 | 완료 | `app/admin/discussions·safety·logs/page.tsx` |
| `lib/email.ts` 이메일 함수 구현 | 완료 | `sendAdminNotification()`, `notifyPendingComment()`, `notifyPendingIssue()` 정의됨 |

---

## 2. 미완료 항목

### 2-1. 배포 전 필수

| 항목 | 현재 상태 |
|------|-----------|
| 이메일 알림 트리거 연결 | `lib/email.ts` 구현됨. `comments/route.ts`, `issues/route.ts`에서 `notifyPendingComment`, `notifyPendingIssue` 호출 없음 |
| `ADMIN_EMAILS` Vercel 환경변수 등록 | 코드 레벨 확인 불가. Vercel 대시보드에서 직접 확인 필요 |
| Resend API Key 발급 및 `.env.local` 등록 | 코드 레벨 확인 불가. `RESEND_API_KEY` 없으면 이메일 발송 건너뜀 (warn만 출력) |

### 2-2. 보안·안정성 (Must)

| 항목 | 현재 상태 | 파일 |
|------|-----------|------|
| Rate Limit 분산 환경 전환 | 메모리 Map 유지 중. `lib/safety.ts`에 `TODO #5` 주석으로 인지됨. 서버리스 다중 인스턴스 시 우회 가능 | `lib/safety.ts` |

### 2-3. 성능·코드 품질 (Should)

| 항목 | 현재 상태 | 파일 |
|------|-----------|------|
| 글로벌 검색 이원화 | `app/search/page.tsx`(서버 직접 조회)와 `/api/search`(API 경유) 두 경로 병존 | `app/search/page.tsx`, `app/api/search/route.ts` |
| 세이프티 검증 완전 통합 | `loadBannedWords()` 공통 함수 정의됨. 댓글 수정(`PATCH`)·토론 생성 등 일부 API에서 호출 여부 미확인 | `app/api/comments/[id]/route.ts`, `app/api/discussions/route.ts` |
| 관리자 mock 데이터 운영 비노출 | `admin/safety·logs/page.tsx` 에서 실데이터 없을 때 mock 표시 여부 미확인 | `app/admin/safety·logs/page.tsx` |

---

## 3. 정오표 (이전 문서 대비 수정 사항)

이전 `99_260224_작업현황.md`에서 **미완료로 잘못 기재된 항목** 정정.

| 항목 | 이전 기재 | 실제 상태 |
|------|-----------|-----------|
| 관리자 경로 보호 재활성화 | 미완료 | **완료** — `middleware.ts` 정상 구현 |
| GNB 관리자 버튼 isAdmin 복구 | 미완료 | **완료** — `Header.tsx` 정상 구현 |
| `requireAdmin()` 공통화 | 미완료 | **완료** — 전체 19개 admin API 적용 |
| 수집 UNIQUE + upsert 전환 | 미완료 | **완료** — `naver-news.ts` 적용 확인 |
| API 사용량 집계 보정 | 미완료 | **완료** — `success_count`, `fail_count` 분리 |
| 검색 debounce + 더보기 경합 제어 | 미완료 | **완료** — `IssueList.tsx` 적용 확인 |
| 댓글 상태값 `pending`/`pending_review` 불일치 | 미완료 | **불일치 없음** — `pending_review` 통일 |
| 투표 트랜잭션 원자화 | 미완료 | **완료** — RPC 함수 적용 |
| 관리자 버튼/경로 보호 재연결 | 미완료 | **완료** |
| dev API 운영 노출 차단 | 미완료 | **완료** — `NODE_ENV` 체크 적용 |
| 커뮤니티 검색/필터 | 확인 필요 | **완료** |
| 댓글 베스트 상단 + 정렬 3종 | 확인 필요 | **완료** |
| "이 이슈의 커뮤니티" 링크 | 확인 필요 | **완료** |

---

## 4. 실제 남은 작업 요약

**필수 (배포 전)**
1. 이메일 트리거 연결 — `comments/route.ts`에서 `pendingReview` 시 `notifyPendingComment()` 호출, `issues/route.ts` POST 시 `notifyPendingIssue()` 호출
2. Resend API Key 발급 + Vercel 환경변수 등록 (`RESEND_API_KEY`, `ADMIN_NOTIFY_EMAILS`, `EMAIL_FROM`)
3. `ADMIN_EMAILS` Vercel 등록 확인

**권고 (운영 안정성)**
4. Rate Limit Redis/Upstash 전환 (`lib/safety.ts`)
5. 세이프티 검증 `PATCH` 댓글·토론 생성에도 `loadBannedWords()` 호출 확인/추가
6. 글로벌 검색 경로 단일화
