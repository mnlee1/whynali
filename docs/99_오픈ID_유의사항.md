# 오픈ID(소셜 로그인) 정책·유의사항

개발자 등록·키 발급·운영 시 유의할 점을 정리한 문서. 구현 전에 한 번씩 확인한다.

---

## 1. 공통 유의사항

**리다이렉트 URI**

- 각 플랫폼(네이버·카카오·구글)에 **실제 사용하는 콜백 URL을 정확히 등록**해야 한다.
- 로컬: `http://localhost:3000/auth/callback`, 네이버 한정 `http://localhost:3000/auth/callback/naver` 등.
- 운영: `https://도메인/auth/callback`, `https://도메인/auth/callback/naver`.
- 네이버는 2024년 1월부터 **equals 검증**으로 바뀌어, 등록된 값과 요청 URL이 **완전 일치**해야 한다. 앞부분만 맞으면 안 됨.

**Client Secret 보안**

- Client Secret은 **서버에서만** 사용. `NEXT_PUBLIC_` 환경 변수에 넣지 말 것.
- 클라이언트에 노출되면 앱이 도용될 수 있음.

**CSRF 방지**

- OAuth 요청 시 `state` 파라미터 사용(네이버·카카오·구글 모두 권장).
- 구현 시 state 생성·검증을 넣어 두는 것이 안전하다.

**토큰·세션**

- 액세스 토큰은 서버 또는 Supabase가 관리하고, 클라이언트에는 세션(쿠키 등)만 전달하는 구조를 권장.
- 우리 프로젝트는 Supabase Auth가 세션을 쿠키로 관리함.

---

## 2. 플랫폼별 유의사항

### 2.1 네이버

**등록**

- [네이버 개발자센터](https://developers.naver.com/apps)에서 애플리케이션 등록.
- "네이버 로그인" API 이용 신청 후 사용.

**설정**

- **Callback URL**: 애플리케이션 설정에 콜백 URL을 **정확히** 입력. (예: `https://도메인/auth/callback/naver`)
- **동의 항목**: 서비스에서 사용하는 항목(이메일, 이름 등)만 요청하고, 미사용 항목은 요청하지 않도록 설정.

**기술**

- Supabase는 네이버를 **기본 제공하지 않음**. 서버에서 인가 코드 → 토큰 교환 → 프로필 조회 후, Supabase 사용자 생성·매직 링크로 세션 부여하는 **별도 구현**이 필요함.

**정책**

- 네이버 로그인 이용약관·개인정보 처리 방침을 준수.
- 리다이렉트 URI 정확 일치(앞부분 일치 방식 폐지됨).

### 2.2 카카오

**등록**

- [카카오 개발자 콘솔](https://developers.kakao.com)에서 앱 생성.
- "카카오 로그인" 제품 설정에서 활성화.

**설정**

- **플랫폼**: Web 플랫폼 등록. 로컬 개발 시 `http://localhost:3000` 등 Redirect URI 등록.
- **Redirect URI**: Supabase를 쓰는 경우 Supabase 대시보드에 나온 콜백 URL을 카카오에 등록. (Supabase가 프로바이더이므로 Supabase 콜백 URL 사용.)
- **동의 항목**: 프로필(닉네임, 프로필 이미지), 이메일 등 필요한 항목만 설정.

**Supabase 연동**

- Supabase 대시보드 → Authentication → Providers → Kakao 활성화.
- Client ID에는 카카오 **REST API 키**, Client Secret에는 **보안 코드**(카카오 콘솔에서 생성) 입력.

**정책**

- 카카오 로그인 운영 정책·개인정보 처리 방침 준수.

### 2.3 구글

**등록**

- [Google Cloud Console](https://console.cloud.google.com)에서 프로젝트 생성.
- "OAuth 동의 화면" 구성(테스트/운영 모드 선택).
- "사용자 인증 정보" → "OAuth 2.0 클라이언트 ID" 생성(웹 애플리케이션).

**설정**

- **승인된 리디렉션 URI**: Supabase 사용 시 Supabase 대시보드에 표시되는 콜백 URL 등록.
- 스코프: 이메일·프로필 등 필요한 범위만 요청.

**Supabase 연동**

- Supabase 대시보드 → Authentication → Providers → Google 활성화.
- Client ID·Client Secret 입력.

**정책**

- OAuth 동의 화면에서 서비스 설명·개인정보 처리 방침 URL 명시.
- 검증이 필요한 스코프는 Google 검수 대응 필요(기본 프로필·이메일은 일반적으로 허용).

---

## 3. 우리 서비스에서의 적용

| 항목 | 내용 |
|------|------|
| 로그인 수단 | 구글·네이버·카카오 오픈ID만 사용(01_AI기획·98_로드맵). |
| 로그인 필요 기능 | 댓글·감정 표현·투표·커뮤니티(토론) 참여. 이슈·타임라인 조회는 비로그인 가능. |
| 구현 | Supabase Auth(구글·카카오) + 네이버는 서버 사이드 OAuth 후 Supabase 세션 연동. |

---

## 4. 체크리스트 (배포 전)

- [ ] 네이버: 앱 등록·Callback URL 정확 등록, 동의 항목 최소화.
- [ ] 카카오: 앱 생성·Web 플랫폼·Redirect URI(Supabase 콜백) 등록, 동의 항목 설정.
- [ ] 구글: OAuth 클라이언트 ID·리디렉션 URI(Supabase 콜백) 등록, 동의 화면 구성.
- [ ] Supabase: Authentication → Providers에서 Google·Kakao 활성화 및 키 입력.
- [ ] Supabase: Authentication → URL Configuration에서 Site URL·Redirect URLs에 다음 포함: `/auth/callback`, `/auth/verify` (네이버 로그인 매직 링크 복귀용). 예: `https://도메인/auth/callback`, `https://도메인/auth/verify`.
- [ ] 환경 변수: Client Secret은 서버 전용으로만 사용, 저장소·클라이언트 번들에 노출되지 않도록 확인.
