# 이슈 등록·화력·정렬 규격

동시 작업(담당 A/B) 시 구현 기준을 하나로 맞추기 위한 수치·계산·정렬 규칙 정리. 판단 근거는 02_AI기획_판단포인트.md, 98_로드맵.md를 따른다.

---

## 1. 이슈 등록 기준

### 1.0 수집 데이터 → 이슈 후보 묶음 (산정식)

**흐름**: 수집 건(뉴스·커뮤니티) → **같은 주제끼리 묶기** → 이슈 후보 1개당 건수 집계 → 1.2~1.4 조건에 따라 알람·승인·이슈 목록 추가.

**입력**: `news_data`(제목, 링크, 출처, 날짜, 카테고리), `community_data`(제목, URL, 조회수, 댓글수, 작성시간). 본문·요약문 없음.

**참조용 묶음 규칙 (동시 작업 시 같은 로직 쓰기 위함)**

1. **시간 창**: 이슈 후보에 넣을 수집 건은 **최근 24시간** 이내 수집된 것만 대상. (이미 이슈로 연결된 건은 제외.)
2. **카테고리**: 뉴스는 네이버 API 카테고리(연예/스포츠/정치/사회/기술)가 있음. **같은 카테고리 내**에서만 묶음. 커뮤니티 건은 카테고리가 없으면 "전체" 풀에서 제목 기준으로만 묶거나, 뉴스와 공통 키워드가 있으면 해당 뉴스 카테고리 후보에 포함.
3. **제목 → 키워드**: 제목을 공백·구두점 기준으로 잘라 토큰 목록으로 둠. 2글자 미만 토큰 제거(선택). 불용어 목록 있으면 제거(선택).
4. **같은 후보 판별**: 두 수집 건이 **(A) 같은 카테고리**이고 **(B) 제목 토큰 집합의 Jaccard 유사도 ≥ 0.2** 이면 같은 이슈 후보.  
   - Jaccard = (교집합 크기) / (합집합 크기).  
   - 또는 **공통 키워드 2개 이상**이면 같은 후보로 둬도 됨. (팀 합의로 둘 중 하나 또는 임계값 조정.)
5. **후보 ID**: 묶음 결과를 Union-Find 등으로 "같은 그룹"으로 합친 뒤, 그룹마다 고유 ID(candidate_id) 부여. 이 그룹이 곧 "이슈 후보" 하나.
6. **이미 승인된 이슈와의 중복**: 기존 이슈에 이미 연결된 수집 건은 해당 후보 집계에서 제외하거나, "기존 이슈로 연결" 후보로만 쓰고 새 이슈 후보로는 세지 않음.

**산정식 요약**

```
후보_그룹 = []
for 각 수집건 in 최근24시간_수집건:
    건_카테고리 = 건.카테고리 (뉴스) 또는 "커뮤니티"
    건_토큰 = tokenize(건.제목)
    for 기존_후보 in 후보_그룹:
        if 기존_후보.카테고리 == 건_카테고리 and jaccard(기존_후보.대표_토큰, 건_토큰) >= 0.2:
            기존_후보에 건 추가; break
    else:
        새 후보 생성(건), 후보_그룹에 추가

각 후보별: 최근_N시간_건수 = count(후보 내 수집건 중 수집시각이 최근 N시간 이내)
# N = CANDIDATE_WINDOW_HOURS (기본 3시간)
```

- **대표_토큰**: 후보에 속한 모든 건의 제목 토큰 합집합, 또는 첫 건의 토큰. (새 건과 비교할 때마다 후보 대표를 갱신해도 됨.)
- Jaccard 대신 "공통 키워드 ≥ 2개"로 할 경우: `len(건_토큰 ∩ 후보_대표_토큰) >= 2`.

**이슈 목록 추가까지의 전체 산정식**

1. 수집 건 DB 적재 (뉴스 30분, 커뮤니티 3분).
2. 위 묶음 규칙으로 **이슈 후보** 그룹 생성.
3. 후보별로 **최근 N시간 건수** 계산 (N = `CANDIDATE_WINDOW_HOURS`, 기본 **3시간**).
4. **커뮤니티 반응 ≥ 1건** 이고 **5건 이상** → 알람 + 관리자 대기 목록에 "즉시 처리" 표시. (커뮤니티 반응이 0이면 이슈 등록 대상 아님)
5. 위 조건 충족 + **10건 이상** + 해당 후보가 **6시간 이상 관리자 무대응** → **자동 승인** → `issues` 행 생성, 수집 건에 `issue_id` 연결. (목록에 추가.)
6. 그 외 후보는 관리자 배치 승인 시 수동으로 이슈 생성·연결.

### 1.1 용어

- **이슈 후보**: 수집 데이터(뉴스·커뮤니티 메타데이터)를 위 1.0 산정식으로 묶은 단위. 하나의 "후보"가 승인되면 **이슈**가 됨.
- **동일 이슈 후보**: 같은 후보 그룹에 속한 수집 건들의 집합.

### 1.2 건수 정의

- **집계 구간**: **최근 3시간** (rolling window). 환경변수 `CANDIDATE_WINDOW_HOURS`로 조정 가능 (기본 3).
- **건수**: 해당 이슈 후보에 속한 **뉴스 수집 건수 + 커뮤니티 수집 건수** 합계.
- 수집 주기: 뉴스 30분, 커뮤니티 3분 (02·98 기준).

### 1.3 알람 조건

| 조건 | 동작 |
|------|------|
| **커뮤니티 반응 ≥ 1건** **그리고** 최근 3시간 건수 ≥ **5건** **그리고** 고유 출처 ≥ **2곳** | `issues` 테이블에 `approval_status='대기'`로 신규 등록 + 수집 건에 `issue_id` 연결 + 관리자 대시보드 상단 해제형 배너 알람. 관리자는 대기 목록에서 승인/반려 처리. |

- **커뮤니티 반응 필수**: 더쿠·네이트판에서 아무도 언급하지 않으면 이슈로 등록하지 않음. 뉴스가 많아도 커뮤니티 반응이 없으면 실제 "난리"가 아닌 것으로 판단. (서비스 컨셉: 커뮤니티 반응으로 실제 난리 여부를 검증)
- 고유 출처 조건: 같은 언론사의 보도자료 반복 배포(신디케이션)를 걸러내기 위함. 커뮤니티 전용 그룹은 출처 조건 적용 안 함.
- 5~9건: 자동 승인 **대상 아님**. 관리자가 대기 목록에서 직접 승인/반려.
- 등록 직후 화력 계산 → **화력 < 10점이면 자동 반려** (`CANDIDATE_MIN_HEAT_TO_REGISTER`, 기본 10). 관리자 목록에 노출되지 않음.
- 최근 24시간 내 같은 제목 이슈가 이미 존재하면 중복 등록 방지 (재등록 안 함).
- 이미 승인/반려된 이슈는 재처리하지 않음.

### 1.4 자동 승인 조건 (B 적용, 02 §2)

| 조건 | 동작 |
|------|------|
| 최근 3시간 건수 ≥ **10건** **그리고** 해당 후보에 대해 **N시간(≥ 6시간)** 동안 관리자 무대응 | 기존 대기 이슈가 있으면 `approval_status='승인'`으로 업데이트. 없으면 바로 `'승인'`으로 신규 생성. |

- **N**: 6시간 이상. 운영 중 12시간 등으로 변경 가능. 2시간처럼 짧게 두지 않음.
- 구현 시 "알람·대기 등록 기준"과 "자동 승인 기준"을 분리 (알람+대기 등록 = 5건 + 출처 2곳, 자동 승인 = 10건 + N시간 무대응).
- 이슈 등록(대기·승인) 직후 연결된 수집 데이터 기준으로 화력 즉시 계산.

### 1.5 구현 시 체크

- [x] 이슈 후보 묶음 규칙: 공통 키워드 ≥ 2개 방식 채택.
- [x] 5건 이상 + 고유 출처 2곳 이상 시 `issues` 테이블에 대기 등록 + 배너 알람.
- [x] 10건 이상 + N시간 무대응 시 자동 승인 (기존 대기 이슈 업데이트 또는 신규 승인 생성).
- [x] 환경 변수로 임계값 조정 가능 (`CANDIDATE_ALERT_THRESHOLD`, `CANDIDATE_AUTO_APPROVE_THRESHOLD`, `CANDIDATE_NO_RESPONSE_HOURS`, `CANDIDATE_MIN_UNIQUE_SOURCES`, `CANDIDATE_WINDOW_HOURS`).

---

## 2. 화력 지수 (heat_index)

### 2.0 두 축: 커뮤니티 화력 vs 뉴스 신뢰/이슈성

서비스에서 필요한 판별을 **두 가지 점수**로 나눈다. 둘 다 메타데이터만 사용 (본문·요약문 미사용, 02·04 준수).

| 축 | 의미 | 점수화 목적 |
|------|------|-------------|
| **커뮤니티 화력 (community_heat)** | 더쿠·네이트판에서의 **난리/논란 정도**. 조회수·댓글수·반응 속도 등. | "지금 커뮤니티에서 얼마나 터지고 있는지" 수치화. |
| **뉴스 신뢰/이슈성 (news_credibility)** | 네이버 뉴스 쪽 **실제 보도·이슈일 가능성**. 가짜 뉴스 또는 단순 소음이 아닌지에 대한 신호. | "여러 언론이 보도한 실제 이슈인지" 수치화. 가짜/과장일수록 낮게. |

**뉴스 신뢰/이슈성 (가짜·비이슈 판별에 가까운 쪽)**

- 본문을 쓰지 않으므로 **메타데이터만**으로 판별. 가능한 신호:
  - **다중 출처**: 같은 이슈 후보에 속한 뉴스가 **서로 다른 언론사(출처)**에서 몇 건인지. 1곳만 보도 vs 5곳 보도 → 후자가 "실제 보도된 이슈"일 가능성 높음.
  - **뉴스 건수**: 해당 후보에 연결된 뉴스 수. (과도한 스팸성 단일 출처 반복은 별도 제거 또는 가중 감소.)
  - (선택) **출처 등급**: 언론사별 신뢰도 테이블을 두고 가중 평균. MVP에서는 "출처 수·다양성"만 써도 됨.
- **가짜 뉴스**를 직접 판별하는 API는 사용하지 않기로 한 정책 유지. "다중 출처 = 검증된 보도일 가능성"으로 **신뢰도 점수**만 산출.

**두 축을 하나의 heat_index로 합치는 방식**

- **heat_index** = f(community_heat, news_credibility). 예:
  - **선형 조합**: `heat_index = w_c * community_heat + w_n * news_credibility` (예: w_c=0.6, w_n=0.4). 둘 다 0–100으로 맞춘 뒤 가중합.
  - **뉴스가 낮으면 화력 억제**: `heat_index = community_heat * (0.5 + 0.5 * news_credibility/100)`. 뉴스 신뢰가 0에 가까우면 최종 화력을 낮춤 (커뮤니티만 난리나도 뉴스로 검증 안 되면 점수 하락).
- 팀 합의로 가중치·공식 선택. 아래 2.3에서 참조 식 제시.

### 2.1 입·출력 규격

| 항목 | 규격 |
|------|------|
| **입력** | 메타데이터만. 본문·요약문 미사용 (02·04 준수). |
| **중간 점수 (권장)** | community_heat (0–100), news_credibility (0–100). §2.0 참조. |
| **최종 출력** | heat_index 0 ~ 100 (정수 또는 소수 1자리). §2.0에서 두 축을 조합. |
| **표시** | 숫자 + 등급 (예: "72 (높음)"). |

### 2.2 등급 구간 (02 §4 확정값)

| 등급 | 구간 |
|------|------|
| 높음 | 70 이상 |
| 보통 | 30 이상 ~ 70 미만 |
| 낮음 | 30 미만 |

- 구현 시 스케일·구간 수·명칭은 팀 합의로 조정 가능. 위는 기본값.

### 2.3 참조용 계산식 (자체 알고리즘 시)

경량 AI 사용 시에는 **두 축(community_heat, news_credibility)** 각각을 API 또는 알고리즘으로 0–100 산출한 뒤, 아래 조합 공식으로 heat_index를 만든다. **자체 알고리즘**만 쓸 때는 아래 식을 참조용으로 사용. (가중치는 팀 합의 후 조정.)

**1) 커뮤니티 화력 (community_heat, 0–100)** — 난리·논란 정도

- 입력: 해당 이슈에 연결된 **커뮤니티 수집 건**만. 조회수 합계, 댓글수 합계, 반응 속도(최근 1시간 건수 등).
- 정규화: 이슈 풀 내 최대값 대비 비율 또는 상한 cap 후 선형 변환.

```
community_raw = (조회수_합 / 5000) * 0.35 + (댓글수_합 / 500) * 0.45
community_heat = round( min(100, max(0, community_raw * 100)) )
```

- 가중치: w_v=0.35 (조회수), w_c=0.45 (댓글수). 댓글수 비중이 높아 논란 정도에 가깝게 반영.
- **만점 기준**: 조회수 합산 약 14,285건 이상 또는 댓글 합산 약 1,111건 이상 (더쿠·네이트판 핫게 중간 이상 기준). 기존 조회수 2,857·댓글 222에서 5배 상향 조정.

**2) 뉴스 신뢰/이슈성 (news_credibility, 0–100)** — 실제 보도·가짜 아님 쪽 신호

- 입력: 해당 이슈에 연결된 **뉴스 수집 건**만. 건수, **서로 다른 출처(언론사) 수**.
- 다중 출처가 많을수록 "여러 매체가 보도한 실제 이슈"일 가능성 높다고 가정. (가짜 뉴스·단일 출처 과장은 상대적으로 낮게.)

```
출처_다양성 = min(20, 해당_이슈_뉴스_서로다른_출처_수)   // 상한 20 (주요 언론 20곳 이상이면 만점)
뉴스_건수_score = min(100, 해당_이슈_뉴스_건수 * 2)       // 50건 이상이면 만점
news_credibility = round( 0.6 * (출처_다양성/20 * 100) + 0.4 * 뉴스_건수_score )
news_credibility = min(100, max(0, news_credibility))
```

- 뉴스가 0건이면 news_credibility = 0. 커뮤니티만 있고 뉴스 없으면 "검증된 이슈"가 아니라고 보아 신뢰 0으로 두고, 아래 조합에서 화력 억제 가능.
- **만점 기준**: 출처 20곳 이상 + 뉴스 50건 이상 (대형 이슈 기준). 기존 출처 10곳·20건에서 상향 조정.

**3) 최종 heat_index — 커뮤니티가 화력을 점화하는 구조**

```
community_amp = community_heat <= 10
    ? 0
    : sqrt(max(0, community_heat - 10) / 90)          // 0~1, 제곱근 곡선
community_amp = min(1.0, community_amp)

heat_index = round( min(100, max(0, news_credibility × (0.3 + 0.7 × community_amp))) )
```

| community_heat | community_amp | 뉴스 100점일 때 화력 |
|---|---|---|
| 0 (없음) | 0 | **30점** — 반려 권장 구간 |
| ≤ 10 | 0 | 30점 — 노이즈 제거 |
| 25 | 0.41 | 59점 |
| 50 | 0.67 | 77점 |
| 70 | 0.82 | 87점 |
| 100 | 1.0 | 100점 |

**설계 의도**

- **뉴스는 "잠재적 이슈 가능성"**, 커뮤니티는 **"실제 난리 여부를 점화"**하는 구조. 서비스 컨셉과 일치.
- 커뮤니티 없으면 화력 최대 30점 → 관리자 기준(30 미만 = 반려 권장)에 자연스럽게 걸림.
- 임계값(communityHeat ≤ 10) 이하는 노이즈(키워드 우연 매칭 1~2건)로 보고 무시.
- 반응이 쌓일수록 제곱근 곡선으로 완만하게 → 급격 상승 방지.

**환경 변수/설정**

- 각 축 가중치·조합 방식을 설정으로 두면 운영 중 조정 가능. 경량 AI 사용 시에는 두 축 각각 API 출력을 0–100으로 받아 위 조합만 적용하면 됨.

### 2.4 구현 시 체크

- [ ] **두 축 분리**: community_heat(난리·논란 정도), news_credibility(뉴스 쪽 실제 이슈/신뢰) 각각 산출 후 조합.
- [ ] 뉴스 신뢰도: 해당 이슈 연결 뉴스의 **서로 다른 출처(언론사) 수** 저장·집계 가능 (news_data.source 활용).
- [ ] 입력은 메타데이터만. 본문·요약문 미참조.
- [ ] 출력 0–100, 등급 높음/보통/낮음(70/30) 적용.
- [ ] 화력 결과는 관리자 승인 없이 자동 반영(02 §4).

---

## 3. 이슈 목록 정렬

### 3.1 기본 정렬 (복합)

**우선순위**

1. **1차**: **현재 상태**. 점화·논란중 → 상단, **종결** → 하단.
2. **2차**: **최신성**. 같은 상태 내에서는 최신 이슈 우선 (예: `updated_at` 또는 이슈 최초 생성/승인 시점 DESC).
3. **3차**: **화력**. 동일 상태·비슷한 시점이면 화력 지수 높은 순.

**상태 순서 (상단 → 하단)**

- 점화 > 논란중 > 종결. (종결은 항상 아래.)

**주의**

- "현재 상태"만 사용. 과거에 종결됐다가 다시 논란중으로 바뀐 이슈는 그 시점부터 상단 쪽으로 정렬 대상.

### 3.2 참조용 정렬 키 (SQL/API)

- **1차**: `status` ORDER BY CASE — 점화=1, 논란중=2, 종결=3 → ASC(점화가 먼저).
- **2차**: `updated_at` DESC (또는 이슈 노출 기준 시점 컬럼).
- **3차**: `heat_index` DESC.

예시 (의사 코드):

```
ORDER BY
  CASE status WHEN '점화' THEN 1 WHEN '논란중' THEN 2 WHEN '종결' THEN 3 END ASC,
  updated_at DESC,
  heat_index DESC
```

- "최신순"만 쓰는 경우: `ORDER BY updated_at DESC`.
- "화력순"만 쓰는 경우: `ORDER BY heat_index DESC` (그때는 상태 구분 없이 화력만 사용 가능. 02에서는 기본은 복합 정렬.)

### 3.3 합산 점수 공식 (sort_score)

하나의 점수로 계산해 `ORDER BY sort_score DESC` 한 번에 쓰고 싶을 때 사용. 1차=상태, 2차=최신성, 3차=화력 순서가 유지되도록 가중치를 크게 둔다.

**점수 구성**

| 항목 | 의미 | 산출 방법 |
|------|------|-----------|
| **상태 점수** | 점화 > 논란중 > 종결 순으로 상단 노출 | 점화=3, 논란중=2, 종결=1 (또는 100/50/0 등 상대 크기만 유지) |
| **최신성 점수** | 같은 상태 안에서는 최신일수록 높게 | `updated_at`을 초 단위 Unix 타임스탬프로 사용 (클수록 최신) |
| **화력 점수** | 이미 0–100 스케일 | `heat_index` 그대로 사용 |

**합산 식 (참조)**

상태가 1·2·3차 중 가장 우선하므로, 상태 점수에 큰 계수를 곱한 뒤 최신성·화력을 더한다.

```
status_weight = (점화=3, 논란중=2, 종결=1)
recency_component = EXTRACT(EPOCH FROM updated_at)   // 초 단위, 최신일수록 큼
heat_component = COALESCE(heat_index, 0)

sort_score = (status_weight * 1e10) + (recency_component * 1e2) + (heat_component / 100)
```

- `1e10`으로 상태가 최우선. 같은 상태 내에서는 `recency_component * 1e2`가 순위를 나누고, 그다음 `heat_index/100`으로 동점을 나눔.
- 구현 시 `status_weight`, 계수(1e10, 1e2 등)는 팀 합의로 조정 가능. DB에 `sort_score` 컬럼을 두고 이슈·화력·상태 변경 시마다 갱신해 두면 목록 API는 `ORDER BY sort_score DESC`만 하면 됨.

**SQL 예시 (PostgreSQL)**

```sql
SELECT *,
  (CASE status WHEN '점화' THEN 3 WHEN '논란중' THEN 2 WHEN '종결' THEN 1 END * 1e10)
  + (EXTRACT(EPOCH FROM updated_at) * 1e2)
  + (COALESCE(heat_index, 0) / 100) AS sort_score
FROM issues
WHERE approval_status = '승인'
ORDER BY sort_score DESC;
```

### 3.4 선택 정렬 옵션 (UI)

- 기본: 위 **복합 정렬** (다단 ORDER BY 또는 §3.3 sort_score).
- (선택) 목록에 "최신순"·"화력순" 전환 옵션 제공 시, 해당 모드에서는 위 1차/2차/3차 대신 단일 키로 정렬.

### 3.5 구현 시 체크

- [ ] 기본 목록 API에 1차=상태, 2차=최신성, 3차=화력 반영 (다단 ORDER BY 또는 sort_score DESC).
- [ ] sort_score 사용 시: 이슈·상태·화력·updated_at 변경 시 sort_score 갱신.
- [ ] 상태 변경 시(종결→논란중 등) 목록/스코어 재계산 반영.

---

## 4. 댓글 점수·베스트 정렬 (02 §6.4 기준)

반응이 좋은 댓글을 상단에 배치하기 위한 점수 계산 및 정렬 규칙.

### 4.1 댓글 점수 (score)

- **계산식**: `score = 좋아요 수 − 싫어요 수` (비례가 아니라 **차이**로 합산.)
- **저장**: `comments` 테이블에 `like_count`, `dislike_count` 컬럼. 조회 시 `score = like_count - dislike_count` 로 계산하거나, 갱신 시마다 `score` 컬럼에 저장해 두어도 됨.
- 사용자가 좋아요/싫어요 누를 때마다 해당 댓글의 like_count 또는 dislike_count를 +1 업데이트.

### 4.2 상단 베스트 댓글

- **목적**: 반응이 좋은 댓글을 상단 영역에 고정 노출.
- **정렬**: `ORDER BY score DESC, created_at DESC`. 상위 N개(예: 3~5개 또는 10개)만 베스트 영역에 표시. 동점이면 최신순.

### 4.3 아래 댓글 리스트 정렬 (사용자 선택)

- **최신순**: `ORDER BY created_at DESC`.
- **좋아요순**: `ORDER BY like_count DESC, created_at DESC`.
- **싫어요순**: `ORDER BY dislike_count DESC, created_at DESC`.
- UI에 탭 또는 드롭다운으로 세 옵션 제공. 리스트 기본값은 **최신순** (또는 팀 합의).

### 4.4 구현 시 체크

- [ ] 댓글 점수 = 좋아요 − 싫어요. 상단 베스트는 score DESC, created_at DESC.
- [ ] 아래 목록은 최신순/좋아요순/싫어요순 중 선택 가능.

---

## 5. 수집-이슈 연결 매칭 기준

### 5.1 자동 연결 흐름

수집된 뉴스·커뮤니티 데이터를 이미 승인된 이슈에 자동 연결한다. 5분마다 Cron으로 실행.

### 5.2 키워드 추출 규칙

- 이슈 제목에서 특수문자 제거 → 공백 분리 → **2글자 미만 제거** → **불용어 제거** → 중복 제거.
- **불용어 목록 (이슈 식별에 무의미한 단어)**: 논란, 사건, 사고, 통보, 불참, 발표, 확인, 관련, 이후, 결국, 충격, 공개, 최초, 단독, 속보, 긴급, 오늘, 어제, 지금, 올해, 최근, 현재, 직접, 처음, 마지막, 드디어, 알고, 보니, 위해, 대해, 통해, 따라, 의해, 부터, 까지, 이번, 해당, 모든, 일부, 전체, 이미, 아직, 더욱, 매우 등.

### 5.3 매칭 방식

| 항목 | 기준 |
|------|------|
| **비교 방식** | 단어 단위 정확 일치 (`includes()` 부분 문자열 매칭 금지) |
| **임계값** | 이슈 키워드의 **50% 이상** 일치 |
| **최소 매칭 수** | **2개 이상** (키워드가 적어도 2개는 일치해야 연결) |

- **단어 단위 비교**: 수집 글 제목도 동일하게 분리한 뒤 Set으로 만들어 정확 일치 여부 확인. 예: 이슈 키워드 `"이재용"`이 `"이재민 구호"` 글에 매칭되지 않음.
- 예시: 이슈 키워드 4개 중 2개 이상(`max(2, floor(4 * 0.5)) = 2`) 일치해야 연결.

### 5.4 구현 시 체크

- [x] `extractKeywords()`: 불용어 제거 포함.
- [x] 수집 글 제목 → `extractTitleWords()` Set 변환 후 `Set.has()`로 정확 일치 비교.
- [x] 임계값: `Math.max(2, Math.floor(keywords.length * 0.5))`.

---

## 6. 설계 결정 노트 (구현 중 발생한 판단 기록)

### 6.1 커뮤니티를 그루핑에서 분리한 이유

**결정**: 뉴스와 커뮤니티를 함께 그루핑하지 않고, 뉴스만 그루핑한 뒤 커뮤니티는 **키워드 매칭** 방식으로 별도 연결.

**배경**:
- 초기 설계는 뉴스+커뮤니티를 하나의 풀에서 공통 키워드 기준으로 함께 그루핑.
- 실제 적용 시 커뮤니티 글 제목과 뉴스 제목의 형태 차이로 매칭 실패가 다수 발생.
  - 뉴스: `"국민의힘 장동혁 절윤 거부 당내 비판 목소리 높아져"`
  - 더쿠: `"장동혁 대표 ㅋㅋㅋ 진짜"`
  - 공통 키워드: `"장동혁"` 1개뿐 → 기준 ≥2면 다른 그룹으로 분리됨

**구현 방향**:
- 뉴스만 집계 창(기본 3시간) 내 데이터로 그루핑.
- 커뮤니티는 최근 24시간 전체를 별도 조회해, 뉴스 그룹의 대표 토큰과 키워드 1개 이상 포함 시 해당 그룹의 커뮤니티 반응으로 연결.
- 커뮤니티 조회 창을 뉴스(3시간)보다 넓게(24시간) 잡은 이유: 더쿠·네이트판 반응 글은 이슈 발생 수 시간 후에 올라오는 경향이 있어 3시간 창으로는 매칭 기회가 거의 없음.

### 6.2 그루핑 공통 키워드 기준 ≥2 → ≥1로 완화한 이유

**결정**: `commonKeywordCount >= 2` → `>= 1`로 낮춤.

**배경**:
- ≥2 기준 적용 시 616건 뉴스가 506개 그룹으로 쪼개짐(그룹당 평균 1.2건).
- 같은 인물/사건 이슈를 다룬 뉴스도 제목 표현 차이로 다른 그룹이 됨.
  - `"장동혁 대표 비판 목소리"` vs `"장동혁 절윤 거부 파문"` → 공통 1개("장동혁")뿐
- ≥1로 변경 후 506개 → 133개로 그루핑 개선.
- 노이즈 방지는 그루핑 기준 대신 `ALERT_THRESHOLD`(5건 이상)와 고유 출처(≥2곳) 조건으로 대응.

### 6.3 커뮤니티 반응 필수 조건의 현실적 한계

**의도**: 뉴스가 많아도 더쿠·네이트판에서 아무도 언급하지 않으면 "실제 난리"가 아닌 것으로 판단해 이슈 등록 제외.

**실제 확인된 문제**:
- 현재 수집 중인 더쿠(연예·일상)와 네이트판(연애·고민) 콘텐츠 특성상, 정치·국제·지역 뉴스와 직접 매칭되는 글이 구조적으로 적음.
- 미연결 뉴스 대다수가 지역지·국제 뉴스 위주로, 더쿠·네이트판에서 다루지 않는 주제임.
- 결과: 커뮤니티 매칭 조건 추가 시 이슈 등록 건수 = 0.

**확정 결정: B. 커뮤니티 조건을 "필수"→"가산점"으로 완화**

- 커뮤니티 반응 없어도 이슈 등록 허용. 매칭된 커뮤니티 글은 issue_id 연결 후 화력 지수에 반영.
- 화력 낮은 이슈는 관리자가 직접 반려 처리. 관리자 이슈 관리 페이지에 화력 기준 안내 UI 제공.
- 화력 기준 (§2.2): 70 이상 → 높음(즉시 승인 권장) / 30–69 → 보통(검토 후 판단) / 30 미만 → 낮음(반려 권장).
- 장기적으로는 **A(수집 소스 확장)**를 검토. DC인사이드(정치·사회) 등 추가 시 매칭 품질 크게 향상될 수 있음.

### 6.4 화력 계산식 — 커뮤니티 점화 구조 채택 이유

**문제**: 이전 공식(`community 없음 → newsCredibility × 1.0`)은 뉴스 50건만 있어도 화력 85점이 나와 서비스 컨셉("커뮤니티가 실제로 난리인지 검증")과 상충.

**선택한 공식**: `heat = newsCredibility × (0.3 + 0.7 × community_amp)`

- 커뮤니티 없으면 화력 최대 30점 → 관리자 반려 기준(30 미만)에 자연스럽게 해당.
- community_amp: 임계값(≤10) 이하는 0, 초과분은 제곱근 곡선으로 증폭.
  - 임계값 이유: 키워드 우연 매칭 1~2건은 실제 커뮤니티 반응이 아님.
  - 제곱근 이유: 선형 증폭은 소량 반응에도 급격히 올라가는 문제 있음. 곡선으로 완만하게.
- 공식 의미: "뉴스는 잠재적 이슈 가능성, 커뮤니티가 화력을 점화한다."

---

## 7. 참조 문서

- [02_AI기획_판단포인트.md](./02_AI기획_판단포인트.md): §2(이슈 등록), §4(화력·정렬 수치)
- [08_이슈상태전환_규격.md](./08_이슈상태전환_규격.md): 점화/논란중/종결 전환 기준 및 Cron 구현 가이드
- [98_로드맵.md](./98_로드맵.md): 담당 A(이슈·수집·화력), Day별 화력·수집 연동
- [97_1단계_기초픽스.md](./97_1단계_기초픽스.md): 스키마(heat_index 등), 1단계 픽스 항목
- [97_API규약.md](./97_API규약.md): API 주소·쿼리(sort 등)·응답 형태. 목록/댓글 정렬 파라미터와 07 §3·§4 연동

---

**작성일**: 2026-02-13  
**용도**: 2단계 분할 작업 시 A/B가 동일 규격으로 구현하기 위한 기준 문서.
