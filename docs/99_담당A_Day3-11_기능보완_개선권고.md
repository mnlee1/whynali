# 담당 A Day3-11 기능보완 개선권고 (프론트엔드/백엔드)

기준 문서: `docs/99_담당A_Day3-11_체크리스트.md`
참조 방식: 체크리스트 우선 + 실제 구현 파일 확인 기반으로 운영/품질 보완안을 정리한다.
우선순위 기준:
- Must: 보안, 정합성, 운영장애 가능성이 높은 항목
- Should: 성능/안정성/운영 효율 개선 효과가 큰 항목
- Could: 중장기 고도화 항목

---

## Day 3-4

### 프론트엔드
1) API 응답 타입 계약 선정의 명문화
- 현상: 같은 실패 상황인데 화면마다 다른 문구/형식으로 보일 수 있음
- 리스크: 사용자는 같은 문제를 다른 문제로 오해할 수 있음
- 개선권고:
  - 목록/상세/타임라인에서 같은 응답 형식을 사용하도록 고정
  - 에러 키(`code`, `message`, `details`)를 통일해 안내 문구 일관성 확보
- 우선순위: Should
- 대상 파일:
  - `lib/api/issues.ts`
  - `types/issue.ts`

#### Day 3-4 UX/UI 피드백 패턴 적용
- 성공/실패 피드백 표준화 (Must)
  - 성공: 토스트 1회 + 화면 상태 즉시 반영
  - 실패: 원인(권한/검증/네트워크)을 구분해 안내
- 에러 문구 일관성 (Should)
  - 같은 원인의 에러는 같은 문구와 같은 위치에서 표시
  - 초기 렌더 상태와 오류 상태의 표현 규칙을 통일

### 백엔드
1) 관리자 API 인증/인가 공통화
- 현상: 관리자 라우트별 권한 검증 패턴이 분산되어 있음
- 리스크: 신규 API 추가 시 검증 누락으로 권한 사고 가능
- 개선권고:
  - `requireAdmin()` 유틸 또는 공통 미들웨어로 단일화
  - 401/403 반환 기준과 메시지 포맷을 통일
- 우선순위: Must
- 대상 파일:
  - `app/api/admin/issues/route.ts`
  - `app/api/admin/issues/[id]/approve/route.ts`
  - `app/api/admin/issues/[id]/reject/route.ts`
  - `app/api/admin/issues/[id]/restore/route.ts`
  - `app/api/admin/issues/[id]/hide/route.ts`

2) 목록/타임라인 입력값 스키마 검증 강화
- 현상: `status`, `category`, `sort`, `limit`, `offset` 검증 범위가 느슨함
- 리스크: 비정상 요청 증가, 예외 응답 편차 확대
- 개선권고:
  - Zod 기반 파라미터 스키마를 공통 모듈로 추출
  - URL/날짜 파싱 실패는 400으로 조기 종료
- 우선순위: Must
- 대상 파일:
  - `app/api/issues/route.ts`
  - `app/api/issues/[id]/timeline/route.ts`

3) 수집 중복 방지의 원자성 확보
- 현상: 사전 조회 후 insert 패턴으로 중복을 회피
- 리스크: Cron 동시 실행 시 중복 레코드 적재 가능
- 개선권고:
  - DB UNIQUE 제약 추가(`news_data.link`, `community_data.url`)
  - `upsert + onConflict` 기반 저장으로 전환
- 우선순위: Must
- 대상 파일:
  - `lib/collectors/naver-news.ts`
  - `lib/collectors/community.ts`

4) API 사용량 집계 기준 보정
- 현상: 일부 구간에서 저장 건수 기준으로 사용량을 누적
- 리스크: 외부 API 한도 경보 시점 오차 발생
- 개선권고:
  - 호출 1회당 +1 기준으로 집계 통일
  - 성공/실패 호출 수를 분리 기록
- 우선순위: Must
- 대상 파일:
  - `app/api/cron/collect-news/route.ts`
  - `lib/api-usage-tracker.ts`

5) 출처 조회 API 페이징 상한 도입
- 현상: 출처 조회 시 전체 rows를 반환하는 구간 존재
- 리스크: 데이터 증가 시 응답 지연과 메모리 사용량 증가
- 개선권고:
  - `limit/offset` 또는 cursor 기반 페이지네이션 적용
  - 기본 최신 N건 + 더보기 방식 도입
- 우선순위: Should
- 대상 파일:
  - `app/api/issues/[id]/sources/route.ts`

---

## Day 5-6

### 프론트엔드
1) 검색 호출 debounce + 트리거 단일화
- 현상: 입력 상태 변경과 Enter 이벤트가 중복 호출될 수 있음
- 리스크: 타이핑 중 화면이 버벅이고 결과가 늦게 뜨는 느낌을 줄 수 있음
- 개선권고:
  - 입력이 잠깐 멈췄을 때만 검색되도록 300~500ms debounce 적용
  - Enter 검색도 같은 함수로 처리해 중복 호출 제거
- 우선순위: Must
- 대상 파일:
  - `components/issues/IssueList.tsx`

2) 더보기 경합 상태 제어
- 현상: 연속 클릭 시 `issues`, `offset` 상태 경합 가능
- 리스크: 카드가 중복되거나 빠져 보이면 사용자가 목록을 신뢰하기 어려움
- 개선권고:
  - 함수형 상태 업데이트로 순서 꼬임 방지
  - 로딩 중에는 더보기 버튼을 잠가 중복 요청 차단
- 우선순위: Must
- 대상 파일:
  - `components/issues/IssueList.tsx`

3) 요청 취소/최신 응답 보장
- 현상: 이전 요청 응답이 늦게 도착하면 최신 화면을 덮어쓸 수 있음
- 리스크: 사용자가 방금 고른 필터와 다른 결과가 보여 혼란이 생김
- 개선권고:
  - `AbortController` 적용
  - request sequence id로 가장 최신 응답만 반영
- 우선순위: Should
- 대상 파일:
  - `components/issues/IssueList.tsx`
  - `lib/api/issues.ts`

4) 상세 페이지 공개 데이터 접근 경계 정리
- 현상: 공개 페이지에서 admin 수준 조회 패턴이 재사용될 여지
- 리스크: 사용자 화면에 불필요한 내부 정보가 섞일 수 있음
- 개선권고:
  - 공개 페이지는 공개 API/readonly client만 사용
  - 관리자 조회 로직은 별도 경로로 분리해 섞이지 않게 관리
- 우선순위: Must
- 대상 파일:
  - `app/issue/[id]/page.tsx`

5) 클라이언트 API 공통 정책 도입
- 현상: 타임아웃/에러 파싱/재시도 정책이 호출 지점별로 분산됨
- 리스크: 어떤 화면은 친절하고 어떤 화면은 불친절한 안내가 표시됨
- 개선권고:
  - 공통 `request()` 래퍼 도입
  - 사용자 메시지와 내부 에러코드 매핑을 통일
- 우선순위: Should
- 대상 파일:
  - `lib/api/issues.ts`

#### Day 5-6 UX/UI 피드백 패턴 적용
- 로딩/중복클릭 제어 (Must)
  - 버튼 클릭 즉시 로딩 표시 + disabled
  - 처리 중 동일 액션 재클릭 차단
- 최신 응답 보장 (Must)
  - 검색/필터/더보기에서 이전 요청 취소
  - 마지막 요청 응답만 화면에 반영
- 빈 상태/초기 상태 구분 (Should)
  - 데이터 없음, 검색 결과 없음, 로딩 후 없음 상태를 분리 표시
  - 다시 시도/필터 초기화 액션 제공

### 백엔드
1) Day 5-6 연동 구간 응답 포맷 정규화
- 현상: 목록/상세/타임라인 응답 메타 규칙이 일관되지 않음
- 리스크: 프론트 분기 처리 증가로 유지보수 비용 상승
- 개선권고:
  - 공통 응답 래퍼(`data`, `meta`, `error`) 적용
  - 페이지네이션 메타 키(`total`, `limit`, `offset`) 통일
- 우선순위: Should
- 대상 파일:
  - `app/api/issues/route.ts`
  - `app/api/issues/[id]/route.ts`
  - `app/api/issues/[id]/timeline/route.ts`

2) 이슈 목록 검색어 escape 처리
- 현상: 특수문자 포함 검색어 입력 시 쿼리 해석이 흔들릴 수 있음
- 리스크: 검색 결과 왜곡 또는 예외 응답 발생
- 개선권고:
  - 검색어 escape 유틸 함수 도입
  - 장기적으로 RPC 기반 검색 경로 검토
- 우선순위: Should
- 대상 파일:
  - `app/api/issues/route.ts`

---

## Day 8-11

### 프론트엔드
1) 관리자 이슈 화면 액션 UX 안전성 강화
- 현상: 일부 액션이 `alert/confirm` 중심으로 처리됨
- 리스크: 버튼을 잘못 누르거나 중복 클릭해도 현재 상태를 파악하기 어려움
- 개선권고:
  - 모달 + 토스트 + 처리중 상태로 바꿔 작업 흐름을 명확하게 표시
  - 실패 시 원인(권한/검증/네트워크)을 구분해 바로 안내
- 우선순위: Should
- 대상 파일:
  - `app/admin/issues/page.tsx`

2) 관리자 상태/액션 표현 일관화
- 현상: 반려/숨김 의미가 UI에서 명확히 분리되지 않음
- 리스크: 운영자가 상태 의미를 헷갈려 잘못된 후속 액션을 할 수 있음
- 개선권고:
  - 상태 뱃지/필터에서 `approval`과 `visibility`를 분리 표시
  - 액션 라벨을 상태 의미와 정확히 맞춰 표시
- 우선순위: Should
- 대상 파일:
  - `app/admin/issues/page.tsx`

3) 관리자 수집현황 링크 경로 정합성 수정
- 현상: 일부 링크가 `/issues/{id}` 경로를 사용함
- 리스크: 클릭했는데 페이지가 열리지 않아 운영 처리 시간이 늘어남
- 개선권고:
  - `/issue/{id}` 경로로 통일
  - 링크 생성 유틸로 하드코딩 제거해 재발 방지
- 우선순위: Must
- 대상 파일:
  - `app/admin/collections/page.tsx`

#### Day 8-11 UX/UI 피드백 패턴 적용
- 권한 차단 UI 명확화 (Must)
  - 비관리자 접근 시 차단 안내 문구 + 이동 액션 제공
  - 관리자 버튼/메뉴는 노출 단계에서 선차단
- 운영 화면 피드백 강화 (Should)
  - 관리자 액션은 성공/실패 건수 요약을 함께 표시
  - 실패 원인을 유형별(권한/검증/네트워크)로 구분 안내
- 운영 mock 데이터 정책 (Should)
  - 운영 환경에서는 mock 데이터 비노출
  - 빈 상태 문구와 다음 액션 가이드로 대체

### 백엔드
1) 숨김/반려 상태 모델 분리
- 현상: hide/reject 동작이 동일 상태계열로 수렴하는 구간 존재
- 리스크: 통계 왜곡, 운영 의미 혼선
- 개선권고:
  - `approval_status`와 `visibility_status` 분리 저장
  - 관리자 목록/통계 계산을 분리 컬럼 기준으로 전환
- 우선순위: Must
- 대상 파일:
  - `app/api/admin/issues/[id]/hide/route.ts`
  - `app/api/admin/issues/[id]/reject/route.ts`
  - `app/api/admin/issues/route.ts`

2) 관리자 수집 통계 total 정확화
- 현상: recent limit과 total 계산이 동일 흐름에 결합됨
- 리스크: 데이터 1000건 초과 시 총량 왜곡
- 개선권고:
  - total은 별도 count 쿼리로 계산
  - recent 목록 조회와 통계 쿼리 분리 유지
- 우선순위: Must
- 대상 파일:
  - `app/api/admin/collections/route.ts`

3) Cron 비밀키 정책 강화
- 현상: `CRON_SECRET` 누락 시 실행 허용 가능 구간 존재
- 리스크: 외부 임의 호출, 비용 증가, 데이터 오염
- 개선권고:
  - production에서 비밀키 누락 시 즉시 차단
  - 누락 이벤트를 오류 로그/알림으로 기록
- 우선순위: Must
- 대상 파일:
  - `app/api/cron/collect-news/route.ts`
  - `app/api/cron/collect-community/route.ts`
  - `app/api/cron/auto-link/route.ts`
  - `app/api/cron/recalculate-heat/route.ts`

4) 자동연결 알고리즘 정밀도 개선
- 현상: 제목 포함률 중심 규칙으로 오연결 가능성 존재
- 리스크: 운영자 수동 보정 비용 증가
- 개선권고:
  - 카테고리/발행시점/금칙어 가중치 반영
  - 최소 점수 미달 시 미연결 유지 + 검토 큐 적재
- 우선순위: Should
- 대상 파일:
  - `lib/linker/issue-news-linker.ts`
  - `lib/linker/issue-community-linker.ts`
  - `app/api/cron/auto-link/route.ts`

5) 화력 재계산 리포트 표준화
- 현상: 성공/실패 요약이 운영 관점에서 충분히 분리되지 않음
- 리스크: 실패 누락 시 대응 지연
- 개선권고:
  - 성공/실패 카운트와 실패 ID 목록 분리 반환
  - 성공 0건 시 평균값 null 처리
- 우선순위: Should
- 대상 파일:
  - `app/api/cron/recalculate-heat/route.ts`

---

## 기타 (일차 미배정)

### 프론트엔드
- 별도 보완점 없음(현 시점 UX/UI 영향 항목 없음).

### 백엔드
1) dev API 운영 노출 차단
- 현상: 내부 점검 API가 운영에서 접근 가능할 여지
- 리스크: 내부 정보 노출, 불필요한 호출 발생
- 개선권고:
  - 운영환경 비활성화 또는 관리자 인증 필수화
  - 접근 로그와 차단 로그를 분리 기록
- 우선순위: Must
- 대상 파일:
  - `app/api/dev/check-tables/route.ts`
  - `app/api/dev/check-news-data/route.ts`
  - `app/api/dev/test-heat/route.ts`

2) 운영 배포 체크 자동화
- 현상: `ADMIN_EMAILS`, `CRON_SECRET` 점검이 수동
- 리스크: 배포 실수로 보안/운영 사고 가능
- 개선권고:
  - CI에서 필수 환경변수 존재 여부 검증
  - `/admin`, `/api/admin` 보호 스모크 테스트 추가
- 우선순위: Must
- 대상 파일:
  - `middleware.ts`
  - 배포 환경변수 설정

---

## 우선 실행 권고 (Top 10)
1. 관리자 API 인증/인가 공통화 (Must)
2. 입력 파라미터 스키마 검증 공통화 (Must)
3. 수집 중복 방지 UNIQUE + upsert 전환 (Must)
4. API 사용량 호출수 기준 집계로 보정 (Must)
5. 검색 debounce + 더보기 경합 제어 (Must)
6. 공개 상세 데이터 접근 경계 분리 (Must)
7. 숨김/반려 상태 모델 분리 (Must)
8. admin collections total 계산 분리 (Must)
9. Cron 비밀키 미설정 실행 차단 (Must)
10. 관리자 링크 `/issue/{id}` 정합성 수정 (Must)
