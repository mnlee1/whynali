# 오픈ID 키 발급·연동 순서 (카카오 → 네이버 → 구글)

카카오부터 순서대로 진행하면 된다. 각 단계에서 나온 URL·키는 다음 단계에서 사용한다.

---

## 0. 공통: Supabase에서 콜백 URL 확인

1. [Supabase 대시보드](https://supabase.com/dashboard) → 프로젝트 선택
2. **Authentication** → **URL Configuration**
3. **Redirect URLs**에 아래 전부 등록. (우리 앱은 Vercel 배포이므로 로컬 + dev + prod 모두 넣는다.)
   - 로컬: `http://localhost:3000/auth/callback`, `http://localhost:3000/auth/verify`
   - Vercel 개발: `https://dev-whynali.vercel.app/auth/callback`, `https://dev-whynali.vercel.app/auth/verify`
   - Vercel 운영: `https://whynali.vercel.app/auth/callback`, `https://whynali.vercel.app/auth/verify`
4. **Site URL**: 실제 접속 기준 주소 하나. 로컬 개발 시 `http://localhost:3000`, 운영 기준이면 `https://whynali.vercel.app` 권장.

구글·카카오는 Supabase가 인증을 받으므로, **Supabase 콜백 URL**을 복사해 둔다.

- **Authentication** → **Providers** → **Kakao** 또는 **Google** 열면 상단에 안내된 **Callback URL**(예: `https://xxxx.supabase.co/auth/v1/callback`)이 있다. 이걸 카카오/구글 쪽에 등록한다.

---

## 1. 카카오

**카카오 개발자센터 메뉴명 (이름 그대로 클릭)**

| 할 일 | 메뉴 경로 |
|-------|-----------|
| 앱 만들기 | **내 애플리케이션** → **애플리케이션 추가하기** |
| 로그인 켜기·동의항목·보안 | **제품** → **카카오 로그인** → **활성화 설정** / **동의항목** / **보안** |
| REST API 키·리다이렉트 URI·web 도메인 | **앱** 하위 **플랫폼 키** → **REST API 키** / **로그인 리다이렉트 URI** / **web** |

앱 선택: 우측 상단 **앱 변경**으로 전환. 왼쪽 사이드바는 **앱** 아래에 **플랫폼 키**, **제품** 등이 있음.

### 1-1. 앱 생성

1. [카카오 개발자 콘솔](https://developers.kakao.com) 로그인
2. **내 애플리케이션** → **애플리케이션 추가하기**
3. 앱 이름·사업자명(개인은 본인 이름 가능) 입력 후 저장

### 1-2. 카카오 로그인 켜기

1. 사용할 앱 선택(우측 상단 **앱 변경**으로 전환 가능)
2. 왼쪽 **제품** → **카카오 로그인** 클릭
3. **활성화 설정**을 **ON**으로 변경

### 1-2-1. 동의항목 설정 (화면에 보이는 항목 전부 정리)

왼쪽 **제품** → **카카오 로그인** → **동의항목** 메뉴로 들어가면 테이블이 나온다. 우리 서비스(댓글·감정·투표용 로그인) 기준으로 각 항목을 어떻게 두면 되는지 정리했다.

| 이름 (ID) | 어떻게 두면 되는지 | 비고 |
|-----------|---------------------|------|
| **닉네임** (profile_nickname) | **필수 동의** 유지 | 댓글·화면에서 "누가 로그인했는지" 표시할 때 필요. 이미 필수 동의면 그대로 둠. |
| **프로필 사진** (profile_image) | **필수 동의** 또는 **선택 동의** | 헤더에 프로필 이미지 안 쓰면 **설정** 눌러서 **선택 동의**로 바꿔도 됨. 그대로 둬도 됨. |
| **카카오계정(이메일)** (account_email) | **권한 없음** 그대로 | 설정 버튼이 없으면 건드리지 않음. 카카오 정책상 비활성화된 상태. 로그인은 됨. |
| **이름** (name) | **권한 없음** 그대로 | 설정 불가. 우리 서비스에서 요청할 필요 없음. |
| **성별** (gender) | **권한 없음** 그대로 | 설정 불가. 필요 없음. |
| **연령대** (age_range) | **권한 없음** 그대로 | 설정 불가. 필요 없음. |
| **생일** (birthday) | **권한 없음** 그대로 | 설정 불가. 필요 없음. |
| **출생 연도** (birthyear) | **권한 없음** 그대로 | 설정 불가. 필요 없음. |
| **카카오계정(전화번호)** (phone_number) | **권한 없음** 그대로 | 설정 불가. 필요 없음. |
| **CI(연계정보)** (account_ci) | **권한 없음** 그대로 | 설정 불가. 본인인증 연동할 때만 쓰는 항목. 필요 없음. |
| **카카오 서비스 내 친구목록...** (friends) | **사용 안 함** 유지 | **설정** 버튼 있음. 들어가서 **사용 안 함**인지 확인. 친구 기능 안 쓰면 반드시 사용 안 함. |
| **카카오톡 채널 추가 상태 및 내역** (plusfriends) | **권한 없음** 그대로 | 설정 불가. 필요 없음. |
| **배송지정보...** (shipping_address) | **권한 없음** 그대로 | 설정 불가. 쇼핑할 때만 쓰는 항목. 필요 없음. |

**정리: 직접 할 일**

- **닉네임·프로필 사진**: 이미 필수 동의면 **그대로 두면 됨**. 프로필 사진을 안 쓸 거면 **프로필 사진**만 **설정** 들어가서 **선택 동의**로 바꿀 수 있음.
- **친구목록**: **설정** 클릭 → 동의 단계 **사용 안 함** 확인 → 저장. (이미 사용 안 함이면 변경 없이 나와도 됨.)
- **나머지(이메일, 이름, 성별, 연령대, 생일, 전화번호, CI, 카카오톡채널, 배송지)**: **권한 없음**이고 설정 버튼이 없으므로 **건드리지 않음**.

**동의 목적 입력이 뜨는 경우 (닉네임·프로필 사진 설정 시)**

- 닉네임: `댓글·감정·투표 참여 시 회원 식별 및 표시`
- 프로필 사진: `로그인 회원 프로필 표시`

### 1-3. 리다이렉트 URI·사이트 도메인 등록

**진입 경로: 왼쪽 [앱] → [플랫폼 키]**

**1) REST API 키 복사**

- **플랫폼 키** 페이지에서 **REST API 키** 섹션의 키 값(예: `87c53e3fb931b6e2ee9cf5a6ac331c7e`) 복사. Supabase Client ID에 넣을 값이다.

**2) 로그인 리다이렉트 URI 등록**

- **플랫폼 키** 페이지 **REST API 키** 섹션에서 **로그인 리다이렉트 URI** 를 클릭하면, 또는 **REST API 키 수정** 화면으로 들어가면 **카카오 로그인 리다이렉트 URI** 입력 칸이 나온다.
- Supabase 대시보드 **Authentication** → **Providers** → **Kakao** 에서 안내하는 **Callback URL**(`https://...supabase.co/auth/v1/callback`) 복사.
- 카카오 **카카오 로그인 리다이렉트 URI** 칸에 붙여넣기. 여러 개면 **+** 로 줄 추가 후 입력.
- **저장** 클릭.

**REST API 키 수정** 화면에 있는 다른 항목:
- **키 이름(필수)**: 그대로 두거나 원하는 이름 입력.
- **호출 허용 IP 주소**: 비워 두면 됨.
- **비즈니스 인증 리다이렉트 URI**: 카카오 로그인만 쓸 때는 비워 둠.

**3) 사이트 도메인(웹 도메인) 등록**

- **플랫폼 키** 페이지에서 **REST API 키** 섹션 아래 **web** 항목이 보이면, **web** 을 클릭해 해당 플랫폼 설정 화면으로 들어간다. 그 안에 **사이트 도메인** 또는 **웹 도메인** 입력 칸이 있으면 아래를 한 줄에 하나씩 추가한다.
- 없으면, **플랫폼 키** 페이지에서 **JavaScript 키** 섹션의 해당 키(**수정** 또는 **설정**)를 열어 **사이트 도메인**/도메인 관련 칸이 있는지 확인한 뒤, 있으면 같은 주소를 등록한다.

등록할 주소:
- `http://localhost:3000`
- `https://dev-whynali.vercel.app`
- `https://whynali.vercel.app`

**저장** 클릭.

### 1-4. 클라이언트 시크릿(보안 코드) 생성

1. 왼쪽 **제품** → **카카오 로그인** → **보안** 메뉴 클릭.
2. **클라이언트 시크릿** 영역에서 **코드 생성** 클릭. 상태를 **사용함**으로 두기.
3. 생성된 **클라이언트 시크릿** 값을 복사해 둠 (한 번만 표시되므로 반드시 저장).

또는 **플랫폼 키** 페이지 → **REST API 키** 섹션의 **클라이언트 시크릿** 링크로 들어가서 같은 설정·생성이 가능한 경우도 있다.

### 1-5. Supabase에 입력

1. Supabase **Authentication** → **Providers** → **Kakao**
2. **Enable Sign in with Kakao** ON
3. **Client ID**: 카카오 **REST API 키** 붙여넣기
4. **Client Secret**: 위에서 만든 **Client Secret** 붙여넣기
5. **Save**

이후 앱에서 "Kakao로 로그인" 클릭 시 카카오 로그인 창 → 로그인 후 우리 앱으로 돌아오면 성공.

### 1-6. 카카오 로그인 오류 "잘못된 요청 (KOE205)" / account_email

**증상:** 로그인 시 "설정하지 않은 동의 항목: account_email" 메시지가 뜬다.

**원인:** Supabase가 카카오 로그인 시 기본으로 `account_email`을 요청하는데, 카카오 앱의 **동의항목**에서 **카카오계정(이메일)** 이 **권한 없음**이면 카카오가 요청을 거부한다.

**해결(우리 앱에서 적용함):** 로그인 요청 시 이메일 스코프를 빼고 `profile_nickname`, `profile_image`만 요청하도록 코드에서 `scopes`를 지정해 두었다. (`app/login/page.tsx`)

**그래도 KOE205가 나오면:** Supabase 서버가 스코프를 덮어쓸 수 있다. 그때는 카카오 개발자센터에서 **카카오계정(이메일)** 을 사용하려면 **추가 기능 신청**(비즈니스 정보·동의항목 신청)을 해서 **권한 없음**을 해제해야 한다. **제품** → **카카오 로그인** → **동의항목** → 해당 항목에서 안내하는 신청 절차를 따른다.

---

## 2. 네이버

**기존 앱에 추가해도 됨**  
뉴스 API용으로 이미 만든 애플리케이션이 있으면, 그 앱에 **네이버 로그인** API만 추가하면 된다. 새 앱을 만들 필요 없음. (내 애플리케이션 → 해당 앱 선택 → API 설정 또는 애플리케이션 등록 화면에서 네이버 로그인 추가.)

### 2-1. 애플리케이션 등록(또는 기존 앱에 로그인 추가)

1. [네이버 개발자센터](https://developers.naver.com/apps) 로그인
2. **기존 앱 사용 시**: 내 애플리케이션에서 해당 앱 선택 후 **네이버 로그인** 추가. **새로 등록 시**: **애플리케이션 등록** → **네이버 로그인** 이용 신청.
3. 애플리케이션 이름·사용 API(네이버 로그인) 선택
4. **Callback URL**을 **정확히** 입력 (오타 없이). 로컬 + Vercel 둘 다 쓰면 전부 등록:
   - `http://localhost:3000/auth/callback/naver`
   - `https://dev-whynali.vercel.app/auth/callback/naver`
   - `https://whynali.vercel.app/auth/callback/naver`
5. **환경 추가**로 위 주소별로 등록

### 2-1-1. 제공 정보 선택 (필수항목·추가항목)

네이버 로그인 추가 시 **제공 정보**에서 어떤 항목을 **필수**로 받을지, **추가(선택)** 로 받을지 정한다. 우리 서비스(댓글·감정·투표용 로그인) 기준 권장 설정은 아래와 같다.

| 항목 | 필수 / 추가(선택) | 선택 이유 |
|------|-------------------|------------|
| **이메일** | **필수** | Supabase 계정 생성·식별에 사용. 우리 콜백 코드가 이메일로 사용자 생성함. |
| **이름** | **필수** | 로그인한 사용자 표시(헤더·댓글 등)에 사용. |
| **닉네임(별명)** | **추가(선택)** | 이름 없을 때 대신 표시할 수 있음. 선택으로 두어도 됨. |
| **프로필 사진** | **추가(선택)** | 헤더 프로필 이미지용. 나중에 쓰면 선택으로 요청. |
| **성별, 연령대, 생일, 출생연도, 휴대전화번호** | **추가(선택)** 또는 요청 안 함 | 우리 서비스에서 쓰지 않으면 요청하지 않음. |

**정리:**  
- **필수항목**: 이메일, 이름  
- **추가(선택)항목**: 닉네임, 프로필 사진 (원하면 선택으로 체크). 성별·연령대 등은 체크하지 않아도 됨.

### 2-1-2. 화면별 기입 가이드 (네이버 API 설정 화면 기준)

**애플리케이션 정보**
- **애플리케이션 이름**: 그대로 두거나 서비스명 (예: 와이널리)
- **사용 API**: 네이버 로그인 체크. 기존에 네이버 뉴스 검색 API 쓰면 둘 다 체크된 상태 유지

**서비스 정보**
- **서비스 URL**: 서비스 메인 주소. 예: `https://whynali.vercel.app` 또는 `https://whynali.com` (운영 도메인)
- **네이버 로그인 Callback URL**: 아래 세 개 모두 등록 (추가 버튼으로 한 줄씩 추가)
  - `http://localhost:3000/auth/callback/naver`
  - `https://dev-whynali.vercel.app/auth/callback/naver`
  - `https://whynali.vercel.app/auth/callback/naver` (또는 `https://whynali.com/auth/callback/naver`)

**제공 정보 선택**
- **필수 항목**: **이름**, **이메일** 체크 (둘 다 필수 동의로 둠)
- **선택 항목**: **별명**, **프로필 이미지**만 체크해도 됨. 성별·연령대·생일·휴대폰 번호는 체크 안 해도 됨

**카테고리**
- 드롭다운에서 **IT/소프트웨어** 또는 서비스 성격에 맞는 항목 선택

**앱 환경**
- **웹** 선택

**개발 상태**
- 로컬·테스트 중이면 **개발 중** 선택. 실제 서비스 오픈 후 **서비스 적용**으로 변경

**이메일 주소**
- 개발자/관리자 연락용 이메일 입력 후 **인증하기** 클릭해 인증 완료

**이용약관 동의**
- **네이버 오픈 API 서비스 약관에 동의합니다.** 체크

마지막에 **확인** 클릭해 저장.

### 2-2. Client ID·Client Secret 확인

1. 등록한 앱 선택 → **애플리케이션 정보**
2. **Client ID**, **Client Secret** 복사

### 2-3. .env.local에 넣기

앱 루트의 `.env.local`에 다음이 있는지 확인하고, 없으면 추가. (이미 있으면 값만 채움.)

```
NAVER_CLIENT_ID=여기에_Client_ID
NAVER_CLIENT_SECRET=여기에_Client_Secret
```

서버 재시작 후 네이버 로그인 버튼으로 테스트. Supabase 대시보드 설정은 필요 없음(네이버는 우리 서버에서 직접 처리).

---

## 3. 구글

### 3-1. 프로젝트·OAuth 동의 화면

1. [Google Cloud Console](https://console.cloud.google.com) 로그인
2. 상단 프로젝트 선택 → **새 프로젝트** (또는 기존 프로젝트 사용)
3. 왼쪽 메뉴 **API 및 서비스** → **OAuth 동의 화면** 클릭
4. **외부** 선택 → **만들기** 클릭
5. **1단계(앱 정보)** 에서 앱 이름·사용자 지원 이메일·개발자 연락처 입력 → **저장 후 계속** 클릭
6. **2단계(범위)** 화면으로 넘어감. 여기서 범위 지정:
   - **범위 추가 또는 삭제** 버튼 클릭 (또는 "범위" 영역의 **추가 또는 삭제**)
   - 목록에서 아래 항목 찾아 체크 후 **업데이트**:
     - `.../auth/userinfo.email` (이메일)
     - `.../auth/userinfo.profile` (프로필, 이름·프로필 사진 등)
     - `openid` (OpenID Connect)
   - **저장 후 계속** 클릭
7. **3단계(테스트 사용자)** 는 MVP면 **저장 후 계속**만 누르고 넘어감 (테스터 추가 생략 가능)
8. **대시보드로 돌아가기** 또는 **완료**

**범위를 못 찾을 때:** OAuth 동의 화면에서 **저장 후 계속**을 한 번 누르면 다음 단계로 넘어간다. 그 다음 화면 제목이 **범위** 또는 **Scopes** 이고, 그 페이지에 **범위 추가 또는 삭제** 버튼이 있다. 이미 동의 화면을 만든 적이 있으면 **OAuth 동의 화면** 메뉴에 들어가서 **앱 수정** 또는 **편집** 후 단계를 넘기면 **범위** 단계가 나온다.

### 3-2. OAuth 클라이언트 ID 만들기

1. **API 및 서비스** → **사용자 인증 정보**
2. **+ 사용자 인증 정보 만들기** → **OAuth 클라이언트 ID**
3. **애플리케이션 유형**: 웹 애플리케이션
4. **승인된 리디렉션 URI**에 **Supabase 콜백 URL**을 넣는다 (우리 앱 URL이 아님):
   - Supabase 대시보드 → **Authentication** → **Providers** → **Google** 클릭
   - **Google** 설정 화면 상단에 **Callback URL (Supabase)** 또는 **Redirect URL**이 안내되어 있음. 그 주소를 **그대로 복사**
   - 형식 예: `https://프로젝트참조ID.supabase.co/auth/v1/callback` (프로젝트마다 다름)
   - 구글 콘솔 **승인된 리디렉션 URI** 란에 **+ URI 추가** 클릭 후 붙여넣기
5. **만들기** → **클라이언트 ID**, **클라이언트 보안 비밀** 복사

### 3-3. Supabase에 입력

1. Supabase **Authentication** → **Providers** → **Google**
2. **Enable Sign in with Google** ON
3. **Client ID**: 구글에서 복사한 클라이언트 ID
4. **Client Secret**: 구글에서 복사한 클라이언트 보안 비밀
5. **Save**

이후 "Google로 로그인"으로 동작 확인.

---

## 요약 체크

| 순서 | 플랫폼 | 키 발급처 | 등록할 Redirect URI | 키 넣는 곳 |
|------|--------|-----------|----------------------|------------|
| 1 | 카카오 | developers.kakao.com | Supabase 콜백 URL | Supabase Providers → Kakao |
| 2 | 네이버 | developers.naver.com | `.../auth/callback/naver` | .env.local (NAVER_CLIENT_ID, _SECRET) |
| 3 | 구글 | console.cloud.google.com | Supabase 콜백 URL | Supabase Providers → Google |

카카오·구글은 Redirect URI에 **Supabase 콜백 URL**을 넣고, 네이버만 **우리 앱의 /auth/callback/naver**를 넣는다.
